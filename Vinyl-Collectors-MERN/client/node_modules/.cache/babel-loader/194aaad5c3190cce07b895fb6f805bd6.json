{"ast":null,"code":"import _regeneratorRuntime from\"D:/GitHub Repositories/Vinyl-Collectors-MERN/client/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"D:/GitHub Repositories/Vinyl-Collectors-MERN/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _toConsumableArray from\"D:/GitHub Repositories/Vinyl-Collectors-MERN/client/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _objectSpread from\"D:/GitHub Repositories/Vinyl-Collectors-MERN/client/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _slicedToArray from\"D:/GitHub Repositories/Vinyl-Collectors-MERN/client/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useState}from'react';import{useMutation}from'@apollo/client';import{ADD_POST}from'../../utils/mutations';import{QUERY_POSTS,QUERY_ME}from'../../utils/queries';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var PostForm=function PostForm(){var _useState=useState(''),_useState2=_slicedToArray(_useState,2),postText=_useState2[0],setText=_useState2[1];var _useState3=useState(0),_useState4=_slicedToArray(_useState3,2),characterCount=_useState4[0],setCharacterCount=_useState4[1];var _useMutation=useMutation(ADD_POST,{update:function update(cache,_ref){var addPost=_ref.data.addPost;// could potentially not exist yet, so wrap in a try/catch\ntry{// update me array's cache\nvar _cache$readQuery=cache.readQuery({query:QUERY_ME}),me=_cache$readQuery.me;cache.writeQuery({query:QUERY_ME,data:{me:_objectSpread(_objectSpread({},me),{},{posts:[].concat(_toConsumableArray(me.posts),[addPost])})}});}catch(e){console.warn(\"First post insertion by user!\");}// update post array's cache\nvar _cache$readQuery2=cache.readQuery({query:QUERY_POSTS}),posts=_cache$readQuery2.posts;cache.writeQuery({query:QUERY_POSTS,data:{posts:[addPost].concat(_toConsumableArray(posts))}});}}),_useMutation2=_slicedToArray(_useMutation,2),addPost=_useMutation2[0],error=_useMutation2[1].error;// update state based on form input changes\nvar handleChange=function handleChange(event){if(event.target.value.length<=280){setText(event.target.value);setCharacterCount(event.target.value.length);}};// submit form\nvar handleFormSubmit=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(event){return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:event.preventDefault();_context.prev=1;_context.next=4;return addPost({variables:{postText:postText}});case 4:// clear form value\nsetText('');setCharacterCount(0);_context.next=11;break;case 8:_context.prev=8;_context.t0=_context[\"catch\"](1);console.error(_context.t0);case 11:case\"end\":return _context.stop();}}},_callee,null,[[1,8]]);}));return function handleFormSubmit(_x){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"p\",{className:\"m-0 \".concat(characterCount===280||error?'text-error':''),children:[\"Character Count: \",characterCount,\"/280\",error&&/*#__PURE__*/_jsx(\"span\",{className:\"ml-2\",children:\"Something went wrong...\"})]}),/*#__PURE__*/_jsxs(\"form\",{className:\"flex-row justify-center justify-space-between-md align-stretch\",onSubmit:handleFormSubmit,children:[/*#__PURE__*/_jsx(\"textarea\",{placeholder:\"Create a new post...\",value:postText,className:\"form-input col-12 col-md-9\",onChange:handleChange}),/*#__PURE__*/_jsx(\"button\",{className:\"btn col-12 col-md-3\",type:\"submit\",children:\"Submit\"})]})]});};export default PostForm;","map":{"version":3,"names":["React","useState","useMutation","ADD_POST","QUERY_POSTS","QUERY_ME","PostForm","postText","setText","characterCount","setCharacterCount","update","cache","addPost","data","readQuery","query","me","writeQuery","posts","e","console","warn","error","handleChange","event","target","value","length","handleFormSubmit","preventDefault","variables"],"sources":["D:/GitHub Repositories/Vinyl-Collectors-MERN/client/src/components/PostForm/index.js"],"sourcesContent":["import React, { useState } from 'react';\n\nimport { useMutation } from '@apollo/client';\nimport { ADD_POST } from '../../utils/mutations';\nimport { QUERY_POSTS, QUERY_ME } from '../../utils/queries';\n\nconst PostForm = () => {\n    const [postText, setText] = useState('');\n    const [characterCount, setCharacterCount] = useState(0);\n\n    const [addPost, { error }] = useMutation(ADD_POST, {\n        update(cache, { data: { addPost } }) {\n\n            // could potentially not exist yet, so wrap in a try/catch\n            try {\n                // update me array's cache\n                const { me } = cache.readQuery({ query: QUERY_ME });\n                cache.writeQuery({\n                    query: QUERY_ME,\n                    data: { me: { ...me, posts: [...me.posts, addPost] } },\n                });\n            } catch (e) {\n                console.warn(\"First post insertion by user!\")\n            }\n\n            // update post array's cache\n            const { posts } = cache.readQuery({ query: QUERY_POSTS });\n            cache.writeQuery({\n                query: QUERY_POSTS,\n                data: { posts: [addPost, ...posts] },\n            });\n        }\n    });\n\n    // update state based on form input changes\n    const handleChange = (event) => {\n        if (event.target.value.length <= 280) {\n            setText(event.target.value);\n            setCharacterCount(event.target.value.length);\n        }\n    };\n\n    // submit form\n    const handleFormSubmit = async (event) => {\n        event.preventDefault();\n\n        try {\n            await addPost({\n                variables: { postText },\n            });\n\n            // clear form value\n            setText('');\n            setCharacterCount(0);\n        } catch (e) {\n            console.error(e);\n        }\n    };\n\n    return (\n        <div>\n            <p\n                className={`m-0 ${characterCount === 280 || error ? 'text-error' : ''}`}\n            >\n                Character Count: {characterCount}/280\n                {error && <span className=\"ml-2\">Something went wrong...</span>}\n            </p>\n            <form\n                className=\"flex-row justify-center justify-space-between-md align-stretch\"\n                onSubmit={handleFormSubmit}\n            >\n                <textarea\n                    placeholder=\"Create a new post...\"\n                    value={postText}\n                    className=\"form-input col-12 col-md-9\"\n                    onChange={handleChange}\n                ></textarea>\n                <button className=\"btn col-12 col-md-3\" type=\"submit\">\n                    Submit\n                </button>\n            </form>\n        </div>\n    );\n};\n\nexport default PostForm;\n"],"mappings":"osBAAA,MAAOA,MAAP,EAAgBC,QAAhB,KAAgC,OAAhC,CAEA,OAASC,WAAT,KAA4B,gBAA5B,CACA,OAASC,QAAT,KAAyB,uBAAzB,CACA,OAASC,WAAT,CAAsBC,QAAtB,KAAsC,qBAAtC,C,wFAEA,GAAMC,SAAQ,CAAG,QAAXA,SAAW,EAAM,CACnB,cAA4BL,QAAQ,CAAC,EAAD,CAApC,wCAAOM,QAAP,eAAiBC,OAAjB,eACA,eAA4CP,QAAQ,CAAC,CAAD,CAApD,yCAAOQ,cAAP,eAAuBC,iBAAvB,eAEA,iBAA6BR,WAAW,CAACC,QAAD,CAAW,CAC/CQ,MAD+C,iBACxCC,KADwC,MACV,IAAbC,QAAa,MAArBC,IAAqB,CAAbD,OAAa,CAEjC;AACA,GAAI,CACA;AACA,qBAAeD,KAAK,CAACG,SAAN,CAAgB,CAAEC,KAAK,CAAEX,QAAT,CAAhB,CAAf,CAAQY,EAAR,kBAAQA,EAAR,CACAL,KAAK,CAACM,UAAN,CAAiB,CACbF,KAAK,CAAEX,QADM,CAEbS,IAAI,CAAE,CAAEG,EAAE,gCAAOA,EAAP,MAAWE,KAAK,8BAAMF,EAAE,CAACE,KAAT,GAAgBN,OAAhB,EAAhB,EAAJ,CAFO,CAAjB,EAIH,CAAC,MAAOO,CAAP,CAAU,CACRC,OAAO,CAACC,IAAR,CAAa,+BAAb,EACH,CAED;AACA,sBAAkBV,KAAK,CAACG,SAAN,CAAgB,CAAEC,KAAK,CAAEZ,WAAT,CAAhB,CAAlB,CAAQe,KAAR,mBAAQA,KAAR,CACAP,KAAK,CAACM,UAAN,CAAiB,CACbF,KAAK,CAAEZ,WADM,CAEbU,IAAI,CAAE,CAAEK,KAAK,EAAGN,OAAH,4BAAeM,KAAf,EAAP,CAFO,CAAjB,EAIH,CArB8C,CAAX,CAAxC,8CAAON,OAAP,kBAAkBU,KAAlB,kBAAkBA,KAAlB,CAwBA;AACA,GAAMC,aAAY,CAAG,QAAfA,aAAe,CAACC,KAAD,CAAW,CAC5B,GAAIA,KAAK,CAACC,MAAN,CAAaC,KAAb,CAAmBC,MAAnB,EAA6B,GAAjC,CAAsC,CAClCpB,OAAO,CAACiB,KAAK,CAACC,MAAN,CAAaC,KAAd,CAAP,CACAjB,iBAAiB,CAACe,KAAK,CAACC,MAAN,CAAaC,KAAb,CAAmBC,MAApB,CAAjB,CACH,CACJ,CALD,CAOA;AACA,GAAMC,iBAAgB,6FAAG,iBAAOJ,KAAP,oHACrBA,KAAK,CAACK,cAAN,GADqB,sCAIXjB,QAAO,CAAC,CACVkB,SAAS,CAAE,CAAExB,QAAQ,CAARA,QAAF,CADD,CAAD,CAJI,QAQjB;AACAC,OAAO,CAAC,EAAD,CAAP,CACAE,iBAAiB,CAAC,CAAD,CAAjB,CAViB,+EAYjBW,OAAO,CAACE,KAAR,cAZiB,oEAAH,kBAAhBM,iBAAgB,6CAAtB,CAgBA,mBACI,oCACI,WACI,SAAS,eAASpB,cAAc,GAAK,GAAnB,EAA0Bc,KAA1B,CAAkC,YAAlC,CAAiD,EAA1D,CADb,+BAGsBd,cAHtB,QAIKc,KAAK,eAAI,aAAM,SAAS,CAAC,MAAhB,qCAJd,GADJ,cAOI,cACI,SAAS,CAAC,gEADd,CAEI,QAAQ,CAAEM,gBAFd,wBAII,iBACI,WAAW,CAAC,sBADhB,CAEI,KAAK,CAAEtB,QAFX,CAGI,SAAS,CAAC,4BAHd,CAII,QAAQ,CAAEiB,YAJd,EAJJ,cAUI,eAAQ,SAAS,CAAC,qBAAlB,CAAwC,IAAI,CAAC,QAA7C,oBAVJ,GAPJ,GADJ,CAwBH,CA7ED,CA+EA,cAAelB,SAAf"},"metadata":{},"sourceType":"module"}